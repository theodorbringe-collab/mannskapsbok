<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Depot rediger oversikt</title>
  <style>
    body { font-family: sans-serif; margin:20px; }
    .btn { padding: 6px 12px; background:#1976d2; color:white; border:none; border-radius:4px; cursor:pointer; margin:2px; }
    .btn:hover { background:#125ea9; }
    .edit-mode input { padding:4px; margin:2px; }
    ul { list-style-type: none; padding-left: 20px; }
    .item { margin: 4px 0; }
  </style>
</head>
<body>

  <button class="btn" onclick="toggleEditMode()">Toggle Rediger Depot</button>
  <button class="btn" onclick="lagreStruktur()">Lagre Struktur</button>
  <div id="struktur-container"></div>

<script>
  let rediger = false;

  // Hent struktur fra localStorage eller bruk default
  const lagreNøkkel = "depotStruktur";
  let depotStruktur = JSON.parse(localStorage.getItem(lagreNøkkel)) || [
    {
      navn: "Fergehallen",
      undermeny: [
        {
          navn: "RC Bjørgvin",
          skap: [
            {
              navn: "Skap 1",
              varer: ["Førstehjelpsbag", "Bandasje"]
            }
          ]
        }
      ]
    }
  ];

  function toggleEditMode(){
    rediger = !rediger;
    renderStruktur();
  }

  function lagreStruktur(){
    localStorage.setItem(lagreNøkkel, JSON.stringify(depotStruktur));
    alert("Lagt til / redigert struktur lagret!");
    rediger = false;
    renderStruktur();
  }

  function renderStruktur(){
    const container = document.getElementById("struktur-container");
    container.innerHTML = "";
    const ul = document.createElement("ul");
    depotStruktur.forEach((oversikt, oi) => {
      const liO = document.createElement("li");
      liO.className = "item";
      if(rediger){
        liO.innerHTML = `<input value="${oversikt.navn}" onchange="endreOversikt(${oi}, this.value)" /> 
          <button class="btn" onclick="fjernOversikt(${oi})">X</button>`;
      } else {
        liO.textContent = oversikt.navn;
      }
      // undermeny
      const ulUnd = document.createElement("ul");
      oversikt.undermeny.forEach((um, umi) => {
        const liUm = document.createElement("li");
        liUm.className = "item";
        if(rediger){
          liUm.innerHTML = `↳ <input value="${um.navn}" onchange="endreUndermeny(${oi}, ${umi}, this.value)" />
            <button class="btn" onclick="fjernUndermeny(${oi}, ${umi})">X</button>`;
        } else {
          liUm.textContent = "↳ " + um.navn;
        }
        // skap
        const ulSkap = document.createElement("ul");
        um.skap.forEach((skap, ski) => {
          const liSk = document.createElement("li");
          liSk.className = "item";
          if(rediger){
            liSk.innerHTML = `↳↳ <input value="${skap.navn}" onchange="endreSkap(${oi}, ${umi}, ${ski}, this.value)" />
              <button class="btn" onclick="fjernSkap(${oi}, ${umi}, ${ski})">X</button>`;
          } else {
            liSk.textContent = "↳↳ " + skap.navn;
          }
          // varer
          const ulVar = document.createElement("ul");
          skap.varer.forEach((vare, vi) => {
            const liVa = document.createElement("li");
            liVa.className = "item";
            if(rediger){
              liVa.innerHTML = `↳↳↳ <input value="${vare}" onchange="endreVare(${oi}, ${umi}, ${ski}, ${vi}, this.value)" />
                <button class="btn" onclick="fjernVare(${oi}, ${umi}, ${ski}, ${vi})">X</button>`;
            } else {
              liVa.textContent = "↳↳↳ " + vare;
            }
            ulVar.appendChild(liVa);
          });
          // legg til vare knapp
          if(rediger){
            const addVareBtn = document.createElement("button");
            addVareBtn.textContent = "Legg til vare";
            addVareBtn.className = "btn";
            addVareBtn.onclick = () => {
              const navn = prompt("Navn på ny vare:");
              if(navn) {
                depotStruktur[oi].undermeny[umi].skap[ski].varer.push(navn);
                renderStruktur();
              }
            };
            liSk.appendChild(addVareBtn);
          }
          liSk.appendChild(ulVar);
          ulSkap.appendChild(liSk);
        });
        // legg til skap knapp
        if(rediger){
          const addSkapBtn = document.createElement("button");
          addSkapBtn.textContent = "Legg til skap";
          addSkapBtn.className = "btn";
          addSkapBtn.onclick = () => {
            const navn = prompt("Navn på nytt skap:");
            if(navn) {
              depotStruktur[oi].undermeny[umi].skap.push({ navn: navn, varer: [] });
              renderStruktur();
            }
          };
          liUm.appendChild(addSkapBtn);
        }
        liUm.appendChild(ulSkap);
        ulUnd.appendChild(liUm);
      });
      // legg til undermeny knapp
      if(rediger){
        const addUmBtn = document.createElement("button");
        addUmBtn.textContent = "Legg til undermeny";
        addUmBtn.className = "btn";
        addUmBtn.onclick = () => {
          const navn = prompt("Navn på ny undermeny:");
          if(navn) {
            depotStruktur[oi].undermeny.push({ navn: navn, skap: [] });
            renderStruktur();
          }
        };
        liO.appendChild(addUmBtn);
      }

      liO.appendChild(ulUnd);
      ul.appendChild(liO);
    });
    // legg til oversikt knapp
    if(rediger){
      const addOversiktBtn = document.createElement("button");
      addOversiktBtn.textContent = "Legg til oversikt";
      addOversiktBtn.className = "btn";
      addOversiktBtn.onclick = () => {
        const navn = prompt("Navn på ny oversikt:");
        if(navn) {
          depotStruktur.push({ navn: navn, undermeny: [] });
          renderStruktur();
        }
      };
      container.appendChild(addOversiktBtn);
    }
    container.appendChild(ul);
  }

  function endreOversikt(oi, val){
    depotStruktur[oi].navn = val;
  }
  function fjernOversikt(oi){
    depotStruktur.splice(oi,1);
    renderStruktur();
  }
  function endreUndermeny(oi, umi, val){
    depotStruktur[oi].undermeny[umi].navn = val;
  }
  function fjernUndermeny(oi, umi){
    depotStruktur[oi].undermeny.splice(umi,1);
    renderStruktur();
  }
  function endreSkap(oi, umi, ski, val){
    depotStruktur[oi].undermeny[umi].skap[ski].navn = val;
  }
  function fjernSkap(oi, umi, ski){
    depotStruktur[oi].undermeny[umi].skap.splice(ski,1);
    renderStruktur();
  }
  function endreVare(oi, umi, ski, vi, val){
    depotStruktur[oi].undermeny[umi].skap[ski].varer[vi] = val;
  }
  function fjernVare(oi, umi, ski, vi){
    depotStruktur[oi].undermeny[umi].skap[ski].varer.splice(vi,1);
    renderStruktur();
  }

  // Initial render
  renderStruktur();
</script>

</body>
</html>
