<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Depot ‚Äì Hierarkisk</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 30px;
      background: #eef2f7;
      color: #333;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .btn {
      background: #1976d2;
      color: white;
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-left: 5px;
    }
    .btn:hover { background: #125ea9; }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h3 {
      margin: 0 0 15px 0;
      font-size: 20px;
      color: #1976d2;
    }
    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-top: 1px solid #ddd;
    }
    .list-item:first-child {
      border-top: none;
    }
    .badge {
      background: #e53935;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      margin-right: 10px;
    }
    .green-btn {
      background: #4CAF50;
      color: white;
      padding: 4px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }
    .edit-input {
      border: 1px solid #aaa;
      padding: 4px;
      font-size: 14px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <button class="btn" onclick="window.location.href='index.html'">‚Üê Tilbake</button>
    <div>
      <button class="btn" onclick="toggleEditMode()">üõ†Ô∏è Rediger</button>
      <button class="btn" onclick="lagreStruktur()">üíæ Lagre</button>
    </div>
  </div>

  <div id="cardsContainer"></div>

  <script>
    let editMode = false;
    const STORAGE_KEY = "depotCardsStruct";
    const DATE_KEY_PREFIX = "lastChecked_";

    let structure = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
      {
        navn: "Stasjon Austevoll",
        undermeny: [
          {
            id: "1",
            navn: "Ambulanseb√•t 581",
            undermeny: [
              {
                id: "2",
                navn: "Bil 19 ‚Äì SV93802",
                undermeny: [
                  { id: "3", navn: "B√•re 123" }
                ]
              }
            ]
          }
        ]
      }
    ];

    function toggleEditMode() {
      editMode = !editMode;
      renderCards();
    }

    function lagreStruktur() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(structure));
      alert("Struktur lagret!");
      editMode = false;
      renderCards();
    }

    function lagreSjekk(id) {
      const now = new Date().toISOString();
      localStorage.setItem(DATE_KEY_PREFIX + id, now);
      renderCards();
    }

    function dagerSiden(id) {
      const datoStr = localStorage.getItem(DATE_KEY_PREFIX + id);
      if (!datoStr) return "‚Äì";
      const dato = new Date(datoStr);
      const n√• = new Date();
      const diff = Math.floor((n√• - dato) / (1000 * 60 * 60 * 24));
      return diff === 0 ? "I dag" : `${diff} dager`;
    }

    function renderUndermeny(items, parent, level = 1) {
      items.forEach(item => {
        const li = document.createElement("div");
        li.className = "list-item";
        li.style.marginLeft = `${level * 30}px`;

        const left = document.createElement("div");
        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = dagerSiden(item.id || item.navn);
        left.appendChild(badge);

        if (editMode) {
          const input = document.createElement("input");
          input.value = item.navn;
          input.className = "edit-input";
          input.onchange = e => item.navn = e.target.value;
          left.appendChild(input);
        } else {
          left.appendChild(document.createTextNode(item.navn));
        }

        li.appendChild(left);

        const right = document.createElement("div");

        const okBtn = document.createElement("button");
        okBtn.className = "green-btn";
        okBtn.textContent = "Alt OK";
        okBtn.onclick = () => lagreSjekk(item.id || item.navn);
        right.appendChild(okBtn);

        if (editMode) {
          const delBtn = document.createElement("button");
          delBtn.textContent = "X";
          delBtn.className = "btn";
          delBtn.onclick = () => {
            items.splice(items.indexOf(item), 1);
            renderCards();
          };
          right.appendChild(delBtn);
        }

        li.appendChild(right);
        parent.appendChild(li);

        // Legg til undermeny-knapp
        if (editMode) {
          const leggTil = document.createElement("button");
          leggTil.className = "btn";
          leggTil.textContent = "‚ûï Legg til undermeny";
          leggTil.style.marginLeft = `${(level + 1) * 30}px`;
          leggTil.onclick = () => {
            const navn = prompt("Navn p√• ny undermeny:");
            if (navn) {
              if (!item.undermeny) item.undermeny = [];
              item.undermeny.push({ id: Date.now(), navn });
              renderCards();
            }
          };
          parent.appendChild(leggTil);
        }

        if (item.undermeny) {
          renderUndermeny(item.undermeny, parent, level + 1);
        }
      });
    }

    function renderCards() {
      const cont = document.getElementById("cardsContainer");
      cont.innerHTML = "";

      structure.forEach((oversikt, oi) => {
        const card = document.createElement("div");
        card.className = "card";

        const h3 = document.createElement("h3");

        if (editMode) {
          const input = document.createElement("input");
          input.value = oversikt.navn;
          input.className = "edit-input";
          input.onchange = e => oversikt.navn = e.target.value;
          h3.appendChild(input);

          const delBtn = document.createElement("button");
          delBtn.textContent = "X";
          delBtn.className = "btn";
          delBtn.onclick = () => {
            structure.splice(oi, 1);
            renderCards();
          };
          h3.appendChild(delBtn);
        } else {
          h3.textContent = oversikt.navn;
        }

        card.appendChild(h3);

        renderUndermeny(oversikt.undermeny, card);

        if (editMode) {
          const leggTil = document.createElement("button");
          leggTil.className = "btn";
          leggTil.textContent = "‚ûï Legg til undermeny";
          leggTil.onclick = () => {
            const navn = prompt("Navn p√• ny undermeny:");
            if (navn) {
              oversikt.undermeny.push({ id: Date.now(), navn });
              renderCards();
            }
          };
          card.appendChild(leggTil);
        }

        cont.appendChild(card);
      });

      if (editMode) {
        const leggTilOversikt = document.createElement("button");
        leggTilOversikt.className = "btn";
        leggTilOversikt.textContent = "‚ûï Legg til oversikt";
        leggTilOversikt.onclick = () => {
          const navn = prompt("Navn p√• ny oversikt:");
          if (navn) {
            structure.push({ navn, undermeny: [] });
            renderCards();
          }
        };
        cont.appendChild(leggTilOversikt);
      }
    }

    document.addEventListener("DOMContentLoaded", renderCards);
  </script>

</body>
</html>
