<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Depot ‚Äì Struktur og Oversikt</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 30px;
      background: #f4f6f8;
      color: #333;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .btn {
      background: #1976d2;
      color: white;
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-left: 5px;
    }
    .btn:hover {
      background: #125ea9;
    }
    .accordion {
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
      background-color: #fff;
    }
    .accordion summary {
      padding: 12px 16px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      list-style: none;
    }
    .accordion summary::-webkit-details-marker {
      display: none;
    }
    .badge-days {
      background: #e53935;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      margin-right: 8px;
    }
    .undermeny {
      padding-left: 20px;
    }
    .rad {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      border-top: 1px solid #eee;
    }
    .rad:nth-child(odd) {
      background: #fafafa;
    }
    .green-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }
    .info-icons {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .info-icons span, .info-icons button.small {
      font-size: 14px;
      cursor: pointer;
    }
    .edit-input {
      border: 1px solid #aaa;
      padding: 2px 6px;
      font-size: 14px;
      margin-right: 5px;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <button class="btn" onclick="window.location.href='index.html'">‚Üê Tilbake til meny</button>
    <div>
      <button class="btn" onclick="toggleEditMode()">üõ†Ô∏è Rediger depot</button>
      <button class="btn" onclick="lagreStruktur()">üíæ Lagre Struktur</button>
    </div>
  </div>

  <div id="containerOversikt"></div>

  <script>
    let editMode = false;
    const STORAGE_KEY = "depotStructure_v2";

    // Initial struktur (mock) eller hent fra localStorage
    let structure = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
      {
        navn: "Oversikt",
        undermeny: [
          {
            navn: "Fergehallen",
            skap: [
              {
                navn: "Skap 1",
                varer: [
                  { navn: "F√∏rstehjelpsbag", antall: 1, status: "ok" },
                  { navn: "Bandasje", antall: 5, status: "ok" }
                ]
              }
            ]
          },
          {
            navn: "RC Bj√∏rgvin",
            skap: [
              {
                navn: "Dokumentmappe",
                varer: [
                  { navn: "Loggbok", antall: 1, status: "ok" }
                ]
              }
            ]
          }
        ]
      }
    ];

    function toggleEditMode(){
      editMode = !editMode;
      renderOversikt();
    }

    function lagreStruktur(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(structure));
      alert("Struktur lagret!");
      editMode = false;
      renderOversikt();
    }

    function renderOversikt(){
      const cont = document.getElementById("containerOversikt");
      cont.innerHTML = "";
      structure.forEach((oversikt, oIndex) => {
        // Niveau 1: Oversikt
        const detailsO = document.createElement("details");
        detailsO.classList.add("accordion");
        const summaryO = document.createElement("summary");

        if(editMode){
          const inputO = document.createElement("input");
          inputO.value = oversikt.navn;
          inputO.classList.add("edit-input");
          inputO.onchange = (e) => oversikt.navn = e.target.value;
          summaryO.appendChild(inputO);
          const btnRemO = document.createElement("button");
          btnRemO.textContent = "X";
          btnRemO.style.marginLeft = "10px";
          btnRemO.onclick = (e) => {
            e.stopPropagation();
            structure.splice(oIndex, 1);
            renderOversikt();
          };
          summaryO.appendChild(btnRemO);
        } else {
          summaryO.textContent = oversikt.navn;
        }

        detailsO.appendChild(summaryO);

        // Niveau 2: Undermenyene
        const umDiv = document.createElement("div");
        umDiv.classList.add("undermeny");

        oversikt.undermeny.forEach((um, uIndex) => {
          const detailsU = document.createElement("details");
          const summaryU = document.createElement("summary");
          
          if(editMode){
            const inputU = document.createElement("input");
            inputU.value = um.navn;
            inputU.classList.add("edit-input");
            inputU.onchange = (e) => um.navn = e.target.value;
            summaryU.appendChild(inputU);
            const btnRemU = document.createElement("button");
            btnRemU.textContent = "X";
            btnRemU.style.marginLeft = "10px";
            btnRemU.onclick = (e) => {
              e.stopPropagation();
              oversikt.undermeny.splice(uIndex, 1);
              renderOversikt();
            };
            summaryU.appendChild(btnRemU);
          } else {
            summaryU.textContent = um.navn;
          }

          detailsU.appendChild(summaryU);

          // Niveau 3: Skap
          const skapDiv = document.createElement("div");
          skapDiv.style.paddingLeft = "20px";

          um.skap.forEach((skap, sIndex) => {
            const detailsS = document.createElement("details");
            const summaryS = document.createElement("summary");

            if(editMode){
              const inputS = document.createElement("input");
              inputS.value = skap.navn;
              inputS.classList.add("edit-input");
              inputS.onchange = (e) => skap.navn = e.target.value;
              summaryS.appendChild(inputS);
              const btnRemS = document.createElement("button");
              btnRemS.textContent = "X";
              btnRemS.style.marginLeft = "10px";
              btnRemS.onclick = (e) => {
                e.stopPropagation();
                um.skap.splice(sIndex, 1);
                renderOversikt();
              };
              summaryS.appendChild(btnRemS);
            } else {
              summaryS.textContent = skap.navn;
            }

            detailsS.appendChild(summaryS);

            // Niveau 4: Varer
            const varerUl = document.createElement("ul");
            varerUl.style.paddingLeft = "20px";
            skap.varer.forEach((vare, vIndex) => {
              const li = document.createElement("li");
              li.style.display = "flex";
              li.style.justifyContent = "space-between";
              li.style.alignItems = "center";
              li.style.padding = "4px 0";

              const left = document.createElement("div");
              left.textContent = vare.navn + (vare.antall !== undefined ? ` ‚Äì ${vare.antall} stk` : "");

              if(vare.status && vare.status === "mangler"){
                const spanWarn = document.createElement("span");
                spanWarn.style.color = "red";
                spanWarn.style.fontWeight = "bold";
                spanWarn.textContent = "‚ö†Ô∏è Mangler";
                left.appendChild(document.createTextNode(" "));
                left.appendChild(spanWarn);
              }

              li.appendChild(left);

              const right = document.createElement("div");
              if(!editMode){
                const okBtn = document.createElement("button");
                okBtn.textContent = "Alt OK";
                okBtn.classList.add("green-btn");
                okBtn.onclick = () => {
                  alert("Alt OK for " + vare.navn);
                };
                right.appendChild(okBtn);
              } else {
                const btnRemV = document.createElement("button");
                btnRemV.textContent = "X";
                btnRemV.classList.add("btn");
                btnRemV.onclick = (e) => {
                  e.stopPropagation();
                  skap.varer.splice(vIndex,1);
                  renderOversikt();
                };
                right.appendChild(btnRemV);
              }

              li.appendChild(right);
              varerUl.appendChild(li);
            });

            // Legg til vare knapp i redigeringsmodus
            if(editMode){
              const btnAddVare = document.createElement("button");
              btnAddVare.textContent = "Legg til vare";
              btnAddVare.classList.add("btn");
              btnAddVare.onclick = () => {
                const navn = prompt("Navn p√• ny vare:");
                if(navn){
                  skap.varer.push({ navn: navn, antall: 1, status: "ok" });
                  renderOversikt();
                }
              };
              skapDiv.appendChild(btnAddVare);
            }

            detailsS.appendChild(varerUl);
            skapDiv.appendChild(detailsS);
          });

          // Legg til skap i redigeringsmodus
          if(editMode){
            const btnAddSkap = document.createElement("button");
            btnAddSkap.textContent = "Legg til skap";
            btnAddSkap.classList.add("btn");
            btnAddSkap.onclick = () => {
              const navn = prompt("Navn p√• nytt skap:");
              if(navn){
                um.skap.push({ navn: navn, varer: [] });
                renderOversikt();
              }
            };
            skapDiv.appendChild(btnAddSkap);
          }

          detailsU.appendChild(skapDiv);
          umDiv.appendChild(detailsU);
        });

        // Legg til undermeny i redigeringsmodus
        if(editMode){
          const btnAddUM = document.createElement("button");
          btnAddUM.textContent = "Legg til undermeny";
          btnAddUM.classList.add("btn");
          btnAddUM.onclick = () => {
            const navn = prompt("Navn p√• ny undermeny:");
            if(navn){
              oversikt.undermeny.push({ navn: navn, skap: [] });
              renderOversikt();
            }
          };
          umDiv.appendChild(btnAddUM);
        }

        detailsO.appendChild(umDiv);
        cont.appendChild(detailsO);
      });

      // Legg til oversikt i redigeringsmodus
      if(editMode){
        const btnAddOvers = document.createElement("button");
        btnAddOvers.textContent = "Legg til oversikt";
        btnAddOvers.classList.add("btn");
        btnAddOvers.onclick = () => {
          const navn = prompt("Navn p√• ny oversikt:");
          if(navn){
            structure.push({ navn: navn, undermeny: [] });
            renderOversikt();
          }
        };
        cont.appendChild(btnAddOvers);
      }
    }

    // F√∏rst rendering
    renderOversikt();
  </script>

</body>
</html>
