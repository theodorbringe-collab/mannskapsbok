<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Depot Oversikt ‚Äì RC Bj√∏rgvin</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 30px;
      background: #f4f6f8;
      color: #333;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .btn {
      background: #1976d2;
      color: white;
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover {
      background: #125ea9;
    }
    .accordion {
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
      background-color: white;
    }
    .accordion summary {
      padding: 12px 16px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      list-style: none;
    }
    .accordion summary::-webkit-details-marker {
      display: none;
    }
    .accordion .badge-days {
      background: #e53935;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }
    .accordion .undermeny {
      padding-left: 20px;
      margin: 0;
    }
    .undermeny .rad {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      border-top: 1px solid #eee;
    }
    .undermeny .rad:nth-child(odd) {
      background: #fafafa;
    }
    .green-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }
    .info-icons {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .info-icons span {
      font-size: 14px;
      cursor: pointer;
    }
    .edit-input {
      border: 1px solid #aaa;
      padding: 2px 6px;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <button class="btn" onclick="window.location.href='index.html'">‚Üê Tilbake til meny</button>
    <button class="btn" onclick="toggleEditMode()">üõ†Ô∏è Rediger Oversikt</button>
    <button class="btn" onclick="lagreStruktur()">üíæ Lagre Endringer</button>
  </div>

  <div id="containerOversikt">
    <!-- Oversikt vil rendres her -->
  </div>

  <script>
    let editMode = false;
    const STORAGE_KEY = "depotStructure";

    // Hent lagret struktur eller bruk standard mock
    let structure = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
      {
        navn: "Stasjon Austevoll",
        enheter: [
          {
            id: "581",
            navn: "581 - ambulanseb√•t",
            dagerSiden: -17,
            merknader: 3,
            plukk: 2,
            seksjoner: [
              {
                navn: "Sidelomme - h√∏yre",
                varer: [
                  { navn: "Oppkastpose", antall: 3, status: "ok" },
                  { navn: "Cellestoff", antall: 0, status: "mangler" },
                  { navn: "Bosspose", antall: 3, status: "ok" }
                ]
              }
            ]
          },
          {
            id: "19",
            navn: "Bil‚Äë19 ‚Äë SV93802",
            dagerSiden: -19,
            merknader: 8,
            plukk: 3,
            seksjoner: []
          }
        ]
      }
    ];

    function toggleEditMode(){
      editMode = !editMode;
      renderOversikt();
    }

    function lagreStruktur(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(structure));
      alert("Struktur lagret!");
      editMode = false;
      renderOversikt();
    }

    function renderOversikt(){
      const cont = document.getElementById("containerOversikt");
      cont.innerHTML = "";
      structure.forEach((oversikt, oIndex) => {
        const details = document.createElement("details");
        details.classList.add("accordion");
        const summary = document.createElement("summary");

        // oversikts navn + eventuelt input hvis rediger
        if(editMode){
          const input = document.createElement("input");
          input.value = oversikt.navn;
          input.classList.add("edit-input");
          input.onchange = (e) => oversikt.navn = e.target.value;
          summary.appendChild(input);
        } else {
          summary.textContent = oversikt.navn;
        }
        // legg til knapp for fjerne oversikt
        if(editMode){
          const btnRem = document.createElement("button");
          btnRem.textContent = "X";
          btnRem.style.marginLeft = "10px";
          btnRem.onclick = (e) => {
            e.stopPropagation();
            structure.splice(oIndex, 1);
            renderOversikt();
          };
          summary.appendChild(btnRem);
        }

        details.appendChild(summary);

        // under enheter
        const umDiv = document.createElement("div");
        umDiv.classList.add("undermeny");
        oversikt.enheter.forEach((eUnit, eIndex) => {
          const rad = document.createElement("div");
          rad.classList.add("rad");

          // venstre del: navn, dager
          const venstre = document.createElement("div");
          const badge = document.createElement("span");
          badge.classList.add("badge-days");
          badge.textContent = `${eUnit.dagerSiden} DAGER`;
          venstre.appendChild(badge);

          if(editMode){
            const inputU = document.createElement("input");
            inputU.value = eUnit.navn;
            inputU.classList.add("edit-input");
            inputU.onchange = (evt) => eUnit.navn = evt.target.value;
            venstre.appendChild(inputU);
          } else {
            venstre.append(" " + eUnit.navn);
          }

          rad.appendChild(venstre);

          // h√∏yre del: ikoner + Alt OK knapp
          const h√∏yre = document.createElement("div");
          h√∏yre.classList.add("info-icons");

          const merknadSpan = document.createElement("span");
          merknadSpan.textContent = `üìù ${eUnit.merknader}`;
          merknadSpan.onclick = () => {
            const txt = prompt("Merknad til depotansvarlig for " + eUnit.navn);
            if(txt) {
              alert("Merknad lagret (simulert)");
              // evt legg til i data
            }
          };
          h√∏yre.appendChild(merknadSpan);

          const plukkSpan = document.createElement("span");
          plukkSpan.textContent = `üõí ${eUnit.plukk}`;
          plukkSpan.onclick = () => {
            const txt = prompt("Innkj√∏psbehov for " + eUnit.navn);
            if(txt) {
              alert("Innkj√∏psbehov lagret (simulert)");
            }
          };
          h√∏yre.appendChild(plukkSpan);

          // Alt OK knapp
          const okBtn = document.createElement("button");
          okBtn.textContent = "Alt OK";
          okBtn.classList.add("green-btn");
          okBtn.onclick = () => {
            alert("Alt OK for " + eUnit.navn);
          };
          h√∏yre.appendChild(okBtn);

          // fjerne enhet hvis editMode
          if(editMode){
            const remUnitBtn = document.createElement("button");
            remUnitBtn.textContent = "X";
            remUnitBtn.classList.add("btn");
            remUnitBtn.onclick = (evt) => {
              evt.stopPropagation();
              oversikt.enheter.splice(eIndex,1);
              renderOversikt();
            };
            h√∏yre.appendChild(remUnitBtn);
          }

          rad.appendChild(h√∏yre);
          umDiv.appendChild(rad);
        });

        // legg til enhet knapp
        if(editMode){
          const btnAddE = document.createElement("button");
          btnAddE.textContent = "Legg til enhet";
          btnAddE.classList.add("btn");
          btnAddE.onclick = () => {
            const navn = prompt("Navn p√• ny enhet:");
            if(navn) {
              oversikt.enheter.push({
                id: Date.now().toString(),
                navn: navn,
                dagerSiden: 0,
                merknader: 0,
                plukk: 0,
                seksjoner: []
              });
              renderOversikt();
            }
          };
          umDiv.appendChild(btnAddE);
        }

        details.appendChild(umDiv);
        cont.appendChild(details);
      });

      // legg til oversikt knapp
      if(editMode){
        const btnAddO = document.createElement("button");
        btnAddO.textContent = "Legg til oversikt";
        btnAddO.classList.add("btn");
        btnAddO.onclick = () => {
          const navn = prompt("Navn p√• ny oversikt:");
          if(navn) {
            structure.push({
              navn: navn,
              enheter: []
            });
            renderOversikt();
          }
        };
        cont.appendChild(btnAddO);
      }
    }

    // initial render
    renderOversikt();
  </script>

</body>
</html>
