<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Depot ‚Äì RC Bj√∏rgvin</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 30px;
      background: #f4f6f8;
      color: #333;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .btn {
      background: #1976d2;
      color: white;
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-left: 5px;
    }
    .btn:hover {
      background: #125ea9;
    }
    .accordion {
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
      background-color: #fff;
    }
    summary {
      padding: 12px 16px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    summary::-webkit-details-marker {
      display: none;
    }
    .badge-days {
      background: #e53935;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      margin-right: 8px;
    }
    .undermeny {
      padding-left: 20px;
    }
    .rad {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      border-top: 1px solid #eee;
    }
    .rad:nth-child(odd) {
      background: #fafafa;
    }
    .green-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }
    .edit-input {
      border: 1px solid #aaa;
      padding: 4px 6px;
      font-size: 14px;
      margin-right: 5px;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <button class="btn" onclick="window.location.href='index.html'">‚Üê Tilbake</button>
    <div>
      <button class="btn" onclick="toggleEditMode()">üõ†Ô∏è Rediger depot</button>
      <button class="btn" onclick="lagreStruktur()">üíæ Lagre</button>
    </div>
  </div>

  <div id="containerOversikt"></div>

  <script>
    let editMode = false;
    const STORAGE_KEY = "depotStructure_v3";
    const DATE_KEY_PREFIX = "lastChecked_";

    // Data
    let structure = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
      {
        navn: "Stasjon Austevoll",
        undermeny: [
          { id: "581", navn: "Ambulanseb√•t 581" },
          { id: "19", navn: "Bil 19 ‚Äì SV93802" }
        ]
      }
    ];

    function toggleEditMode(){
      editMode = !editMode;
      renderOversikt();
    }

    function lagreStruktur(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(structure));
      alert("Struktur lagret!");
      editMode = false;
      renderOversikt();
    }

    function lagreSjekk(enhetId){
      const now = new Date().toISOString();
      localStorage.setItem(DATE_KEY_PREFIX + enhetId, now);
      renderOversikt();
    }

    function dagerSidenSistSjekk(enhetId){
      const datoStr = localStorage.getItem(DATE_KEY_PREFIX + enhetId);
      if(!datoStr) return "‚Äì";
      const sist = new Date(datoStr);
      const n√• = new Date();
      const diff = Math.floor((n√• - sist) / (1000 * 60 * 60 * 24));
      return diff === 0 ? "‚úì I dag" : `- ${diff} dager`;
    }

    function renderOversikt(){
      const cont = document.getElementById("containerOversikt");
      cont.innerHTML = "";

      structure.forEach((oversikt, oIndex) => {
        const detailsO = document.createElement("details");
        detailsO.classList.add("accordion");
        const summaryO = document.createElement("summary");

        if(editMode){
          const input = document.createElement("input");
          input.className = "edit-input";
          input.value = oversikt.navn;
          input.onchange = e => structure[oIndex].navn = e.target.value;
          summaryO.appendChild(input);

          const btnX = document.createElement("button");
          btnX.textContent = "X";
          btnX.className = "btn";
          btnX.onclick = e => {
            e.stopPropagation();
            structure.splice(oIndex, 1);
            renderOversikt();
          };
          summaryO.appendChild(btnX);
        } else {
          summaryO.textContent = oversikt.navn;
        }

        detailsO.appendChild(summaryO);

        const innerDiv = document.createElement("div");
        innerDiv.className = "undermeny";

        oversikt.undermeny?.forEach((um, uIndex) => {
          const rad = document.createElement("div");
          rad.className = "rad";

          const venstre = document.createElement("div");
          venstre.innerHTML = `<span class="badge-days">${dagerSidenSistSjekk(um.id || um.navn)}</span>`;

          if(editMode){
            const input = document.createElement("input");
            input.className = "edit-input";
            input.value = um.navn;
            input.onchange = e => structure[oIndex].undermeny[uIndex].navn = e.target.value;
            venstre.appendChild(input);

            const btnDel = document.createElement("button");
            btnDel.textContent = "X";
            btnDel.className = "btn";
            btnDel.onclick = () => {
              structure[oIndex].undermeny.splice(uIndex, 1);
              renderOversikt();
            };
            venstre.appendChild(btnDel);
          } else {
            venstre.innerHTML += um.navn;
          }

          const h√∏yre = document.createElement("div");

          if(!editMode){
            const okBtn = document.createElement("button");
            okBtn.className = "green-btn";
            okBtn.textContent = "Alt OK";
            okBtn.onclick = () => {
              const id = um.id || um.navn;
              lagreSjekk(id);
            };
            h√∏yre.appendChild(okBtn);
          }

          rad.appendChild(venstre);
          rad.appendChild(h√∏yre);
          innerDiv.appendChild(rad);
        });

        if(editMode){
          const btnAdd = document.createElement("button");
          btnAdd.className = "btn";
          btnAdd.textContent = "‚ûï Legg til undermeny";
          btnAdd.onclick = () => {
            const navn = prompt("Navn p√• ny undermeny:");
            if(!structure[oIndex].undermeny) structure[oIndex].undermeny = [];
            if(navn){
              structure[oIndex].undermeny.push({ id: Date.now(), navn });
              renderOversikt();
            }
          };
          innerDiv.appendChild(btnAdd);
        }

        detailsO.appendChild(innerDiv);
        cont.appendChild(detailsO);
      });

      if(editMode){
        const btnAddOversikt = document.createElement("button");
        btnAddOversikt.className = "btn";
        btnAddOversikt.textContent = "‚ûï Legg til oversikt";
        btnAddOversikt.onclick = () => {
          const navn = prompt("Navn p√• ny oversikt:");
          if(navn){
            structure.push({ navn: navn, undermeny: [] });
            renderOversikt();
          }
        };
        cont.appendChild(btnAddOversikt);
      }
    }

    document.addEventListener("DOMContentLoaded", renderOversikt);
  </script>

</body>
</html>
