<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Beredskap RC Bj√∏rgvin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin:0; background:#f4f4f4; padding:2rem; display:flex; flex-direction:column; align-items:center; }
    h1 { color:#0d47a1; margin-bottom:1rem; }
    button { cursor:pointer; }
    .status-button, #newVesselBtn, #newPersonBtn, #resetBtn { padding:0.7rem 1.2rem; background:#0d47a1; color:white; border:none; border-radius:6px; font-size:1rem; margin:0.5rem 0; }
    .fleet { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:1.5rem; width:100%; max-width:1200px; }
    .vessel { border-radius:12px; padding:1rem; color:white; display:flex; flex-direction:column; gap:0.6rem; box-shadow:0 6px 14px rgba(0,0,0,0.1); }
    .green { background:#2e7d32; } .red{ background:#c62828;} .gray{ background:#616161;}
    .avvik-list { background:#fff; color:#000; padding:0.5rem; border-radius:6px; font-size:0.85rem; }
    .avvik-item { display:flex; justify-content:space-between; border-bottom:1px solid #ddd; padding:0.2rem 0; }
    .avvik-item button { background:#c62828; border:none; color:white; font-size:0.75rem; padding:0.2rem 0.5rem; border-radius:4px; }
    .btns { display:flex; gap:0.5rem; }
    .btn { flex:1; padding:0.5rem; border:none; border-radius:6px; font-size:0.9rem; background:#ffffff33; color:#fff; }
    #vaktelefon { margin-top:3rem; padding:1rem; border-radius:12px; background:#fff; box-shadow:0 6px 14px rgba(0,0,0,0.1); width:100%; max-width:600px; }
    .vaktperson { display:flex; justify-content:space-between; align-items:center; padding:0.5rem 0; border-bottom:1px solid #ddd; }
    .toggleVakt { padding:0.4rem 1rem; border:none; border-radius:20px; color:#fff; font-weight:bold; }
    .toggleVakt.green { background:#2e7d32; } .toggleVakt.red { background:#c62828; }
    .removeBtn { background:#c62828; color:white; border:none; padding:0.3rem 0.7rem; border-radius:6px; font-size:0.8rem; margin-left:0.5rem; }
  </style>
</head>
<body>
  <h1>Beredskap RC Bj√∏rgvin</h1>

  <a href="https://public.kystportal.no/rkh.asp?_side=3" target="_blank">
    <button class="status-button">üîç √Öpne statusbilde (Kystportal)</button>
  </a>

  <button id="newVesselBtn">‚ûï Legg til nytt fart√∏y</button>
  <div class="fleet" id="fleetContainer"></div>

  <!-- üì± Vaktelefon -->
  <div id="vaktelefon">
    <h2>Beredskap ‚Äì Vaktelefon</h2>
    <div id="vakContainer"></div>
    <button id="newPersonBtn">‚ûï Legg til person</button>
  </div>

  <button id="resetBtn">‚ôªÔ∏è Nullstill all data</button>

  <script>
    const statusOptions = [
      { text: 'I drift', color: 'green' },
      { text: 'I drift ‚Äì Beredskap p√• henger', color: 'green' },
      { text: 'I drift ‚Äì p√• sj√∏', color: 'green' },
      { text: 'Ute av drift teknisk', color: 'red' },
      { text: 'Ute av drift Mannskapsmangel', color: 'red' },
      { text: 'P√• verksted', color: 'gray' },
      { text: 'P√• lager', color: 'gray' }
    ];

    let vessels = JSON.parse(localStorage.getItem('vessels')) || [];
    let vaktpersoner = JSON.parse(localStorage.getItem('vaktpersoner')) || [];

    function save() {
      localStorage.setItem('vessels', JSON.stringify(vessels));
      localStorage.setItem('vaktpersoner', JSON.stringify(vaktpersoner));
    }

    function render() {
      // üö§ Fart√∏y
      const container = document.getElementById('fleetContainer');
      container.innerHTML = vessels.length === 0 ? "<p>Ingen fart√∏y registrert.</p>" : "";
      vessels.forEach((vessel, i) => {
        const div = document.createElement('div');
        div.className = `vessel ${statusOptions[vessel.status].color}`;
        div.innerHTML = `
          <input type="text" value="${vessel.name}" onchange="endreNavn(${i}, this.value)">
          <select onchange="endreStatus(${i}, this.value)">
            ${statusOptions.map((s, idx) => `<option value="${idx}" ${idx==vessel.status?'selected':''}>${s.text}</option>`).join('')}
          </select>
          <textarea placeholder="Kommentar..." onchange="endreKommentar(${i}, this.value)">${vessel.kommentar || ''}</textarea>
          <div class="avvik-list">${vessel.avvik.length? '': '<em>Ingen avvik</em>'}</div>
          <div class="btns">
            <button class="btn" onclick="registrerAvvik(${i})">‚ûï Avvik</button>
            <button class="btn" onclick="slettFartoy(${i})">üóë Slett</button>
          </div>
        `;
        container.appendChild(div);
        const avvikDiv = div.querySelector(".avvik-list");
        vessel.avvik.forEach((a,j) => {
          const item = document.createElement('div');
          item.className="avvik-item";
          item.innerHTML = `<span>[${a.tid}] ${a.tekst}</span><button onclick="slettAvvik(${i},${j})">X</button>`;
          avvikDiv.appendChild(item);
        });
      });

      // üì± Vaktelefon
      const vakContainer = document.getElementById('vakContainer');
      vakContainer.innerHTML = vaktpersoner.length===0? "<p>Ingen personer registrert.</p>" : "";
      vaktpersoner.forEach((p, idx) => {
        const row = document.createElement('div');
        row.className="vaktperson";
        row.innerHTML=`
          <span>${p.navn}</span>
          <div>
            <button class="toggleVakt ${p.aktiv?'green':'red'}" onclick="toggleVakt(${idx})">
              ${p.aktiv?'P√• vakt':'Av vakt'}
            </button>
            <button class="removeBtn" onclick="removePerson(${idx})">Slett</button>
          </div>
        `;
        vakContainer.appendChild(row);
      });
    }

    // üö§ Fart√∏y-funksjoner
    function endreStatus(i,val){ vessels[i].status=parseInt(val); save(); render(); }
    function endreNavn(i,navn){ vessels[i].name=navn; save(); render(); }
    function endreKommentar(i,txt){ vessels[i].kommentar=txt; save(); }
    function slettFartoy(i){ if(confirm("Slett fart√∏y?")){ vessels.splice(i,1); save(); render(); } }
    function registrerAvvik(i){
      const txt=prompt("Beskriv avvik:");
      if(txt){ 
        const n√•=new Date();
        const tid=n√•.toLocaleDateString('no-NO')+" "+n√•.toLocaleTimeString('no-NO',{hour:'2-digit',minute:'2-digit'});
        vessels[i].avvik.push({tekst:txt, tid:tid});
        save(); render();
      }
    }
    function slettAvvik(i,j){ vessels[i].avvik.splice(j,1); save(); render(); }

    // üì± Vaktelefon-funksjoner
    function toggleVakt(i){ vaktpersoner[i].aktiv=!vaktpersoner[i].aktiv; save(); render(); }
    function removePerson(i){ if(confirm("Fjern person?")){ vaktpersoner.splice(i,1); save(); render(); } }

    // üñ±Ô∏è Event Listeners
    document.getElementById('newVesselBtn').addEventListener('click',()=>{
      const navn=prompt("Navn p√• nytt fart√∏y:");
      if(navn){ vessels.push({name:navn,status:0,kommentar:'',avvik:[]}); save(); render(); }
    });
    document.getElementById('newPersonBtn').addEventListener('click',()=>{
      const navn=prompt("Navn p√• ny person:");
      if(navn){ vaktpersoner.push({navn:navn,aktiv:false}); save(); render(); }
    });
    document.getElementById('resetBtn').addEventListener('click',()=>{
      if(confirm("Vil du nullstille all data?")){ localStorage.clear(); vessels=[]; vaktpersoner=[]; render(); }
    });

    // Init
    render();
  </script>
</body>
</html>
